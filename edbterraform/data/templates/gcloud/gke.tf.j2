module "gke_{{ region_ }}" {
  source = "./modules/gke"

  for_each = ({
    for rm in lookup(module.spec.region_gke, "{{ region }}", []) : 
      rm.name => rm 
    })

  cluster_name                    = var.spec.cluster_name
  region                          = each.value.spec.region
  machine                         = each.value
  subnetwork                      = module.network_{{ region_ }}[each.value.spec.zone].name
  network                         = module.vpc_{{ region_ }}.name
  name_id                         = module.spec.hex_id

  depends_on = [module.security_{{ region_ }}]

  providers = {
    google = google.{{ region_ }}
  }

}
